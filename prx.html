<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Orbit | Proxy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="icon" href="/res/orbit.png">
<link rel="stylesheet" href="/style.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
:root{
  --main-bg:#0f1420;
  --panel:#1b2133;
  --panel2:#232a40;
  --text:#e6e9f2;
  --accent:#6c7cff;
}

html,body{
  margin:0;
  padding:0;
  height:100%;
  background:var(--main-bg);
  font-family:system-ui,sans-serif;
  color:var(--text);
  overflow:hidden;
}

#browserUI{
  position:fixed;
  top:80px;
  left:0;
  width:100%;
  background:var(--panel);
  padding:10px 14px;
  display:flex;
  align-items:center;
  gap:10px;
  z-index:5;
  box-sizing:border-box;
}

.nav-btn{
  background:var(--panel2);
  border:none;
  color:var(--text);
  padding:8px 10px;
  border-radius:8px;
  cursor:pointer;
}

.nav-btn:hover{
  background:var(--accent);
}

#urlInput{
  flex:1;
  padding:9px 14px;
  border-radius:30px;
  border:none;
  outline:none;
  font-size:14px;
  background:#0f1420;
  color:white;
}

#proxyContainer{
  position:fixed;
  top:140px;
  left:0;
  width:100%;
  height:calc(100vh - 140px);
}

#proxyFrame{
  width:100%;
  height:100%;
  border:none;
}
</style>
</head>

<body>
<header class="topbar" id="navMount"></header>
<nav class="menu" id="menu"></nav>

<div id="browserUI">
  <button class="nav-btn" id="backBtn"><i class="fa-solid fa-arrow-left"></i></button>
  <button class="nav-btn" id="forwardBtn"><i class="fa-solid fa-arrow-right"></i></button>
  <button class="nav-btn" id="refreshBtn"><i class="fa-solid fa-rotate-right"></i></button>
  <input id="urlInput" type="text" placeholder="Search or type a URL">
</div>

<div id="proxyContainer">
  <iframe id="proxyFrame"></iframe>
</div>

<script src="frame.js"></script>
<script src="script.js"></script>

<script>
const iframe=document.getElementById("proxyFrame")
const input=document.getElementById("urlInput")
const backBtn=document.getElementById("backBtn")
const forwardBtn=document.getElementById("forwardBtn")
const refreshBtn=document.getElementById("refreshBtn")

let historyStack=[]
let historyIndex=-1

function formatInput(value){
  value=value.trim()
  if(!value)return null
  if(value.startsWith("http"))return value
  if(value.includes("."))return "https://"+value
  return "https://start.duckduckgo.com/?q="+encodeURIComponent(value)
}

function load(value,addHistory=true){
  const formatted=formatInput(value)
  if(!formatted){
    iframe.src="newtab.html"
    input.value=""
    return
  }

  iframe.src="embed.html#"+encodeURIComponent(formatted)
  input.value=value
  location.hash=encodeURIComponent(value)

  if(addHistory){
    historyStack=historyStack.slice(0,historyIndex+1)
    historyStack.push(value)
    historyIndex++
  }
}

input.addEventListener("keydown",e=>{
  if(e.key==="Enter") load(input.value)
})

backBtn.onclick=()=>{
  if(historyIndex>0){
    historyIndex--
    load(historyStack[historyIndex],false)
  }
}

forwardBtn.onclick=()=>{
  if(historyIndex<historyStack.length-1){
    historyIndex++
    load(historyStack[historyIndex],false)
  }
}

refreshBtn.onclick=()=>{
  if(historyIndex>=0){
    load(historyStack[historyIndex],false)
  }
}

window.addEventListener("load",()=>{
  const hash=decodeURIComponent(location.hash.slice(1))
  if(hash){
    input.value=hash
    load(hash)
  }else{
    iframe.src="newtab.html"
  }
})
</script>

</body>
</html>
